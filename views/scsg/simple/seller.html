{js:artTemplate}
{set:$swfloadObject = new Swfupload('/simple/goods_img_upload');$swfloadObject->show();}

<script type='text/javascript' src='{theme:javascript/artTemplate/area_select.js}'></script>

<div class="wrapper clearfix">
	<div class="wrap_box">
		<div id="fp_form">
			<h3 class="notice">申请加盟商户</h3>
			<p class="tips">加入我们的电商平台，成为我们的供应商，一起共创美好未来</p>
			<div class="box">
				<form action="{url:/simple/seller_reg}" method="post" enctype='multipart/form-data' name="sellerForm">
					<input type='hidden' name="img" value="" />
					<input type='hidden' name="_imgList" value="" />
					<table class="form_table">
						<colgroup>
							<col width="300px" />
							<col />
						</colgroup>

						<tbody>
							<tr>
								<th>登陆用户名：</th>
								<td><input class="normal" name="seller_name" type="text" value="" pattern="required" alt="用户名不能为空" /><label>* 用户名称（必填）支持中文、字母、数字、“-”“_”的组合，4-20个字符</label></td>
							</tr>
							<tr>
								<th>密码：</th><td><input class="normal" name="password" type="password" alt='请输入6-12位字符' bind='repassword' pattern="^[\S]{6,12}$" /><label>* 登录密码（必填）建议使用字母、数字和符号两种及以上的组合，6-20个字符</label></td>
							</tr>
							<tr>
								<th>确认密码：</th><td><input class="normal" name="repassword" alt='请再次输入密码' type="password" bind='password' pattern="^[\S]{6,12}$" /><label>* 请再次输入密码</label></td>
							</tr>

							<tr>
								<th>商户真实全称：</th>
								<td><input class="normal" name="true_name" type="text" value="" pattern="required" /></td>
							</tr>
							<tr>
								<th>商家logo图片：</th>
								<td>
								<input type='file' name='logo_img' />
								</td>
							</tr>

							<tr>
								<th>商户资质材料：</th>
								<td>
									<div class="box upload_btn">
										<span id='uploadButton'></span>
									</div>
									<label class="tip">可以上传多张图片，分辨率3000px以下，大小不得超过{echo:IUpload::getMaxSize()}</label>

									<div class="box" id="divFileProgressContainer" style="margin-bottom:10px;"></div>
									<div class="box" id="thumbnails"></div>

									<!--图片模板-->
									<script type='text/html' id='picTemplate'>
										<span class='pic'>
					<img onclick="defaultImage(this);" style="margin:5px; opacity:1;width:100px;height:100px" src="{webroot:<%=picRoot%>}" alt="<%=picRoot%>" /><br />
					<a href='javascript:void(0)' onclick="$(this).parent().remove();">删除</a>
				</span>
									</script>
								</td>
							</tr>
							<tr>
								<th>固定电话：</th>
								<td><input type="text" class="normal" name="phone" pattern="phone" /><label>* 固定电话联系方式，如：010-88888888</label></td>
							</tr>
							<tr>
								<th>手机号码：</th>
								<td><input type="text" class="normal" name="mobile" pattern="mobi" /><label>* 移动电话联系方式：如：13000000000</label></td>
							</tr>
							<tr>
								<th>邮箱：</th>
								<td><input type="text" class="normal" name="email" /><label>电子邮箱联系方式</label></td>
							</tr>
							<tr>
								<th>地区：</th>
								<td>
									<select name="province" child="city,area" onchange="areaChangeCallback(this);"></select>
									<select name="city" child="area" parent="province" onchange="areaChangeCallback(this);"></select>
									<select name="area" parent="city"></select>
								</td>
							</tr>
							<tr>
								<th>详细地址：</th><td><input class="normal" name="address" type="text" empty value="" /></td>
							</tr>
							<tr>
								<th>企业官网：</th>
								<td><input class="normal" name="home_url" type="text" pattern="url" empty value="" /><label>填写完整的网址，如：http://www.aircheng.com</label></td>
							</tr>
							<tr>
								<td></td>
								<td>
									<input class="submit" type="submit" value="申请加盟" onclick="return checkForm()" />
								</td>
							</tr>
						</tbody>
					</table>
				</form>
			</div>
		</div>
	</div>
</div>

<script language="javascript">
//DOM加载完毕
$(function(){
	//初始化地域联动
	template.compile("areaTemplate",areaTemplate);

	//修改模式
	{if:isset($this->sellerRow)}
		var formObj = new Form('sellerForm');
		formObj.init({echo:JSON::encode($this->sellerRow)});

		//城市设置
		{if:isset($this->sellerRow['area'])}
			createAreaSelect('province',0,"{$this->sellerRow['province']}");
			createAreaSelect('city',"{$this->sellerRow['province']}","{$this->sellerRow['city']}");
			createAreaSelect('area',"{$this->sellerRow['city']}","{$this->sellerRow['area']}");
		{else:}
			createAreaSelect('province',0,"");
		{/if}
	{else:}
		createAreaSelect('province',0,'');
	{/if}
});

/**
 * 生成地域js联动下拉框
 * @param name
 * @param parent_id
 * @param select_id
 */
function createAreaSelect(name,parent_id,select_id)
{
	//生成地区
	$.getJSON("{url:/block/area_child}",{"aid":parent_id,"random":Math.random()},function(json)
	{
		$('[name="'+name+'"]').html(template.render('areaTemplate',{"select_id":select_id,"data":json}));
	});
}

/**
 * 图片上传回调,handers.js回调
 * @param picJson => {'flag','img','list','show'}
 */
function uploadPicCallback(picJson)
{
	//window.realAlert(JSON.stringify(picJson));
	var picHtml = template.render('picTemplate',{'picRoot':picJson.img});
	$('#thumbnails').append(picHtml);

	//默认设置第一个为默认图片
	if($('#thumbnails img[class="current"]').length == 0)
	{
		$('#thumbnails img:first').addClass('current');
	}
}

//提交表单前的检查
function checkForm()
{
	//整理商品图片
	var goodsPhoto = [];
	$('#thumbnails img').each(function(){
		goodsPhoto.push(this.alt);
	});
	if(goodsPhoto.length > 0)
	{
		$('input[name="_imgList"]').val(goodsPhoto.join(','));
		$('input[name="img"]').val($('#thumbnails img[class="current"]').attr('alt'));
	}


	return true;
}
</script>
