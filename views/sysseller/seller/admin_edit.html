{set:$seller_id = $this->seller['seller_id']}
<article class="module width_full">
    <header>
        <h3 class="tabs_involved">{if:isset($this->adminRow['id'])}编辑{else:}添加{/if}</h3>
    </header>
    <form action="{url:/seller/admin_edit_act}" method="post" name="admin_edit">
        <input type='hidden' name='id' />
        <div class="module_content">
            <fieldset>
                <label>用户名</label>
                <div class="box">
                    <input type='text' name='admin_name' class='small' pattern='^\w{4,20}$' alt='请填写英文字母，数字或下划线，在4-20个字符之间' onblur="checkName();" />
                    <label class="tip">* 管理员登录后台的用户名，请填写英文字母，数字或下划线，在4-20个字符之间</label>
                </div>
            </fieldset>
            {if:$this->adminRow['id']}
            <fieldset>
                <label>密码重设：</label>
                <div class="box">
                    <button type='button' class='btn' onclick="reset_pwd();"><span>重 设</span></button>
                </div>
            </fieldset>
            {/if}
            <fieldset name="pwd">
                <label>密码：</label>
                <div class="box">
                    <input type='password' class='small' name='password' pattern='^\w{6,32}$' alt='请填写英文字母，数字或下划线，在6-32个字符之间' />
                    <label>* 管理员登录后台的密码，请填写英文字母，数字或下划线，在6-32个字符之间</label>
                </div>
            </fieldset>
            <fieldset name="pwd">
                <label>重复密码：</label>
                <div class="box">
                    <input type='password' class='small' name='repassword' pattern='^\w{6,32}$' alt='重复输入管理员登录后台的密码' bind='password' />
                    <label>* 重复输入管理员登录后台的密码</label>
                </div>
            </fieldset>
            <fieldset>
                <label>是否开启</label>
                <div class="box">
                    <label class='attr' ><input type='radio' name='is_del' value='0' checked="checked" />开启</label>
                    <label class='attr' ><input type='radio' name='is_del' value='1' />关闭</label>
                </div>
            </fieldset>
            <fieldset>
                <label>角色：</label>
                <label>
                    <select class='small' name='role_id' pattern='required' alt='请选择一个角色'>
                        <option value=''>请选择</option>
                        <option value="0">超级管理员</option>
                        {query:name=admin_role where=is_del eq 0 and seller_id eq $seller_id}
                        <option value='{$item['id']}'>{$item['name']}</option>
                        {/query}
                    </select>
                    <label>*为管理员分配一个角色</label>

                    <label class='attr'><button id="specAddButton" class="btn" type="button" onclick="window.location.href='{url:/seller/role_edit}'"><span class="add">添加角色</span></button></label>
                </td>
            </fieldset>
            <fieldset>
                <label>Email</label>
                <div class="box">
                    <input type='text' name='email' class='normal' pattern='email' empty alt='请填写正确的email格式' />
                    <label>联系此管理员的email邮箱地址</label>
                </div>
            </fieldset>
        </div>
        <footer>
            <div class="submit_link">
                <input type="submit" class="alt_btn" value="确 定" />
                <input type="reset" value="重 置" />
            </div>
        </footer>
    </form>
</article>

<script type='text/javascript'>

    //ajax检查admin_name唯一性
    function checkName()
    {
        var nameVal = $('[name="admin_name"]').val(); //获取登录名
        var idVal   = $('[name="id"]').val();         //获取id

        jQuery.post(
            '{url:/seller/check_admin}',{admin_name:nameVal,admin_id:idVal},function(content)
            {
                var content = $.trim(content);
                if(content == -1)
                {
                    $('[name="admin_name"]').removeClass('valid-text');
                    $('#unique').removeClass('valid-msg');

                    $('[name="admin_name"]').addClass('invalid-text');
                    $('#unique').addClass('invalid-msg');

                    $('#unique').html(nameVal+'用户名已经存在，请重新更换一个');
                }
            }
        );
    }

    //展示密码重设
    function reset_pwd()
    {
        $('[name="reset_pwd"]').hide();

        $('[name="pwd"]').each(
            function (i)
            {
                $('[name="pwd"]:eq('+i+')').show();
            }
        );
    }

    //修改信息时自动隐藏
    {if:$this->adminRow['id']}
        $('[name="pwd"]').hide();
    {/if}

    //表单回填
    var formObj = new Form('admin_edit');
    formObj.init
    ({
        'id':'{$this->adminRow['id']}',
        'admin_name':'{$this->adminRow['admin_name']}',
        'role_id':'{$this->adminRow['role_id']}',
        'email':'{$this->adminRow['email']}',
        'is_del':'{$this->adminRow['is_del']}'
    });
</script>