<article class="module width_full">
    <header>
        <h3 class="tabs_involved">{if:isset($this->roleRow['id'])}编辑{else:}添加{/if}角色</h3>
    </header>
    <form action="{url:/seller/role_edit_act}" method="post" name="role_edit">
        <input type='hidden' name='id' />
        <div class="module_content">
            <fieldset>
                <label>名称</label>
                <div class="box">
                    <input type='text' class='normal' name='name' pattern='required' alt='请填写角色名称' />
                    <label class="tip">* 角色名称</label>
                </div>
            </fieldset>
            <fieldset>
                <label>是否开启</label>
                <div class="box">
                    <label class='attr' ><input type='radio' name='is_del' value='0' checked="checked" />启用</label>
                    <label class='attr' ><input type='radio' name='is_del' value='1' />禁用</label>
                </div>
            </fieldset>
            <fieldset>
                <label>权限分配：</label>
                <div class="box">
                    {if:!empty($this->rightArray)}
                    {foreach:items = $this->rightArray item = $groupRight key = $rightKey}
                    <div style='clear:both;padding-top:10px' class='bold'>{$rightKey} <label><input type='checkbox' id='checkbox_{$rightKey}' onclick='checkGroupAll(this,"{$rightKey}");' />全选</label></div>
                    <ul class='attr_list' id='ul_{$rightKey}' alt="{$rightKey}">
                        {foreach:items = $groupRight}
                        {set:$is_focus = false}
                        {if:stripos($this->roleRow['rights'],$item['right']) !== false}
                        {set:$is_focus = true}
                        {/if}
                        <li><label class='{if:$is_focus == true}green{else:}attr{/if}'><input type='checkbox' value='{$item['id']}' name='right[]' {if:$is_focus == true}checked=checked{/if} onclick='checkItem("{$rightKey}");' />{$item['name']}</label></li>
                        {/foreach}
                    </ul>
                    {/foreach}
                    {/if}

                    {if:!empty($this->rightUndefined)}
                    <ul class='attr_list'>
                        {foreach:items = $this->rightUndefined}
                        <li><label class='{if:$is_focus == true}green{else:}attr{/if}'><input type='checkbox' value='{$item['id']}' name='right[]' {if:$is_focus == true}checked=checked{/if} />{$item['name']}</label></li>
                        {/foreach}
                    </ul>
                    {/if}
                </div>
            </fieldset>
        </div>
        <footer>
            <div class="submit_link">
                <input type="submit" class="alt_btn" value="确 定" />
                <input type="reset" value="重 置" />
            </div>
        </footer>
    </form>
</article>

<script type='text/javascript'>
    var formObj = new Form('role_edit');
    formObj.init({
        'id':'{$this->roleRow['id']}',
        'name':'{$this->roleRow['name']}',
        'is_del':'{$this->roleRow['is_del']}'
    });

    //分组权限全选
    function checkGroupAll(obj,nameVal)
    {
        if(obj.checked == true)
        {
            $('#ul_'+nameVal+' [name="right[]"]').attr('checked',true);
        }
        else
        {
            $('#ul_'+nameVal+' [name="right[]"]').attr('checked',false);
        }
    }

    //选择权限
    function checkItem(nameVal)
    {
        var totalNum   = $('#ul_'+nameVal+' [name="right[]"]').length;
        var checkedNum = $('#ul_'+nameVal+' [name="right[]"]:checked').length;
        if(checkedNum >= totalNum)
        {
            $('#checkbox_'+nameVal).attr('checked',true);
        }
        else
        {
            $('#checkbox_'+nameVal).attr('checked',false);
        }
    }

    //预选择复选框
    jQuery(function(){
        $('ul.attr_list[alt]').each(
            function(i)
            {
                checkItem($(this).attr('alt'));
            }
        );
    });
</script>