{js:kindeditor}
{js:artTemplate}
<script type='text/javascript' src='{theme:javascript/artTemplate/area_select.js}'></script>

<div class="headbar">
	<div class="position"><span>会员</span><span>></span><span>会员管理</span><span>></span><span>编辑会员</span></div>
</div>
<div class="content_box">
	<div class="content form_content">
		<form action="{url:/member/deliver_save}" method="post" name="memberForm">
			<input name="id" value="" type="hidden" value="{$this->deliverRow['id']}"/>
			<table class="form_table">
				<col width="150px" />
				<col />
				<tbody>
					<tr>
						<th>登录名</th>
						<td><input class="normal" name="username" type="text" value="{$this->deliverRow['username']}"  alt="用户名不能为空" /><label>用户名称</label></td>
					</tr>

					<tr>
						<th>姓名：</th>
						<td><input class="normal" name="true_name" type="text" value="{$this->deliverRow['true_name']}" /><label>真实姓名</label></td>
					</tr>

					<tr>
						<th>手机：</th>
						<td><input class="normal" name="mobile" type="text" value="{$this->deliverRow['mobile']}" empty pattern="mobi" alt="格式不正确" /><label>手机号码</label></td>
					</tr>
					<tr>
						<th>密码：</th><td><input class="normal" name="password" type="password" /><label>登录密码</label></td>
					</tr>

					<tr>
						<th>地区：</th>
						<td>
							<select name="province" child="city,area" onchange="areaChangeCallback(this);"></select>
							<select name="city" child="area" parent="province" onchange="areaChangeCallback(this);"></select>
							<select name="area" parent="city"></select>
						</td>
					</tr>
					<tr>
						<th>地址：</th><td><input class="normal" name="address" type="text" value="{$this->deliverRow['address']}" /><label>联系地址</label></td>
					</tr>

					<tr>
						<th>状态：</th>
						<td>
							<select name="status">
								<option value="1" >正常</option>
								<option value="2">删除</option>
								<option value="3">锁定</option>
							</select>
						</td>
					</tr>
					<tr>
						<td></td><td><button class="submit" type="submit"><span>确 定</span></button></td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
</div>

<script language="javascript">
//DOM加载完毕
$(function(){
	//初始化地域联动
	template.compile("areaTemplate",areaTemplate);

	//修改模式
	{if:isset($this->deliverRow)}
		var formObj = new Form('memberForm');
		formObj.init({echo:JSON::encode($this->deliverRow)});

		//城市设置
		{if:$this->deliverRow['area']}

			createAreaSelect('province',0,"{$this->deliverRow['province']}");
			createAreaSelect('city',"{$this->deliverRow['province']}","{$this->deliverRow['city']}");
			createAreaSelect('area',"{$this->deliverRow['city']}","{$this->deliverRow['area']}");
		{else:}
			createAreaSelect('province',0,"");
		{/if}

		
	{else:}
		createAreaSelect('province',0,'');
	{/if}
});

/**
 * 生成地域js联动下拉框
 * @param name
 * @param parent_id
 * @param select_id
 */
function createAreaSelect(name,parent_id,select_id)
{
	//生成地区
	$.getJSON("{url:/block/area_child}",{"aid":parent_id,"random":Math.random()},function(json)
	{
		$('[name="'+name+'"]').html(template.render('areaTemplate',{"select_id":select_id,"data":json}));
	});
}
</script>
